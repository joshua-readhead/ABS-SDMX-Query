

<html>

<head>
    <title>Household Projections, Australia, 2011 to 2036</title>
    <meta http-equiv="Cache-Control" content="no-store" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js" type="text/javascript"></script>
    <script type="text/javascript">(
    

    function() {
        var myConnector = tableau.makeConnector();
        var tableInfo = {
            id : "ABS_BA_SA2_ASGS2016",
            alias : "Building Approvals by Statistical Area (SA2 and above)",
            columns : [
              { id : "MEASURE", alias : "Measure", dataType : tableau.dataTypeEnum.string },
              { id : "SECTOR", alias : "Sector of Ownership", dataType : tableau.dataTypeEnum.string },
              { id : "WORK", alias : "Type of Work", dataType : tableau.dataTypeEnum.string },
              { id : "BUILDING_TYPE", alias : "Type of Building", dataType : tableau.dataTypeEnum.string },
              { id : "REGIONTYPE", alias : "Geography Level", dataType : tableau.dataTypeEnum.string },
              { id : "ASGS_2016", alias : "Region", dataType : tableau.dataTypeEnum.string },
              { id : "FREQUENCY", alias : "Frequency", dataType : tableau.dataTypeEnum.string },
              { id : "TIME_PERIOD", alias : "Time", dataType : tableau.dataTypeEnum.string },
              { id : "VALUE", alias : "Value", dataType : tableau.dataTypeEnum.float }
            ]
        };
        myConnector.getSchema = function(schemaCallback) {
            schemaCallback([tableInfo]);
        };
        myConnector.getData = function(table, doneCallback) {
        	var getDataRow = function(resp, key) {
        		var row = {};
        		var arrKey = key.split(':');
        		for(var i=0;i<arrKey.length;i++) {
        			row[tableInfo.columns[i].id]=resp.structure.dimensions.observation[i].values[arrKey[i]].name;
        		}
        		row["VALUE"] = resp.dataSets[0].observations[key][0];
        		return row;
        	}
		$.ajaxSetup({
  timeout: 15*60*1000
});
            $.getJSON("http://stat.data.abs.gov.au/sdmx-json/data/ABS_BA_SA2_ASGS2016/all/all?startTime=2018-08&endTime=2018-08&dimensionAtObservation=allDimensions", function(resp) {
                var obsvs = resp.dataSets[0].observations;
                var tableData = [];
                for (var i = 0, len = Object.keys(obsvs).length; i < len; i++) {
                    var key = Object.keys(obsvs)[i];                    
                    tableData.push(getDataRow(resp,key));
                }
                table.appendRows(tableData);
                doneCallback();
            });

        };
        tableau.registerConnector(myConnector);
        $(document).ready(function () {
		    $("#submitButton").click(function () {
		        tableau.connectionName = "Building Approvals by Statistical Area (SA2 and above)";
		        tableau.submit();
		    });
		});
    })();
</script>
</head>

<body>
    <div class="container container-table">
        <div class="row vertical-center-row">
            <div class="text-center col-md-4 col-md-offset-4">
                <button type="button" id="submitButton" class="btn btn-success" style="margin: 10px;">Building Approvals</button>
            </div>
        </div>
    </div>
</body>
</html>
